
# ğŸ† ì¬í™œìš© í’ˆëª© ë¶„ë¥˜ë¥¼ ìœ„í•œ Object Detection

## ğŸ¥‡ íŒ€ êµ¬ì„±ì›

#### ë°•ì¬ìš°, ì´ìƒì§„, ìœ í¬ì„, ì •ì§€í›ˆ, ì²œìœ ë™, ì„ìš©ì„­


## í”„ë¡œì íŠ¸ ì†Œê°œ
ë°”ì•¼íë¡œ ëŒ€ëŸ‰ ìƒì‚°, ëŒ€ëŸ‰ ì†Œë¹„ì˜ ì‹œëŒ€. ìš°ë¦¬ëŠ” ë§ì€ ë¬¼ê±´ì´ ëŒ€ëŸ‰ìœ¼ë¡œ ìƒì‚°ë˜ê³ , ì†Œë¹„ë˜ëŠ” ì‹œëŒ€ë¥¼ ì‚´ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ¬í•œ ë¬¸í™”ëŠ” 'ì“°ë ˆê¸° ëŒ€ë€', 'ë§¤ë¦½ì§€ ë¶€ì¡±'ê³¼ ê°™ì€ ì—¬ëŸ¬ ì‚¬íšŒ ë¬¸ì œë¥¼ ë‚³ê³  ìˆìŠµë‹ˆë‹¤.

ë¶„ë¦¬ìˆ˜ê±°ëŠ” ì´ëŸ¬í•œ í™˜ê²½ ë¶€ë‹´ì„ ì¤„ì¼ ìˆ˜ ìˆëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì˜ ë¶„ë¦¬ë°°ì¶œ ëœ ì“°ë ˆê¸°ëŠ” ìì›ìœ¼ë¡œì„œ ê°€ì¹˜ë¥¼ ì¸ì •ë°›ì•„ ì¬í™œìš©ë˜ì§€ë§Œ, ì˜ëª» ë¶„ë¦¬ë°°ì¶œ ë˜ë©´ ê·¸ëŒ€ë¡œ íê¸°ë¬¼ë¡œ ë¶„ë¥˜ë˜ì–´ ë§¤ë¦½ ë˜ëŠ” ì†Œê°ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ì‚¬ì§„ì—ì„œ ì“°ë ˆê¸°ë¥¼ Detection í•˜ëŠ” ëª¨ë¸ì„ ë§Œë“¤ì–´ ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•´ë³´ê³ ì í•©ë‹ˆë‹¤. ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ë°ì´í„°ì…‹ìœ¼ë¡œëŠ” ì¼ë°˜ ì“°ë ˆê¸°, í”Œë¼ìŠ¤í‹±, ì¢…ì´, ìœ ë¦¬ ë“± 10 ì¢…ë¥˜ì˜ ì“°ë ˆê¸°ê°€ ì°íŒ ì‚¬ì§„ ë°ì´í„°ì…‹ì´ ì œê³µë©ë‹ˆë‹¤.

ì—¬ëŸ¬ë¶„ì— ì˜í•´ ë§Œë“¤ì–´ì§„ ìš°ìˆ˜í•œ ì„±ëŠ¥ì˜ ëª¨ë¸ì€ ì“°ë ˆê¸°ì¥ì— ì„¤ì¹˜ë˜ì–´ ì •í™•í•œ ë¶„ë¦¬ìˆ˜ê±°ë¥¼ ë•ê±°ë‚˜, ì–´ë¦°ì•„ì´ë“¤ì˜ ë¶„ë¦¬ìˆ˜ê±° êµìœ¡ ë“±ì— ì‚¬ìš©ë  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤. ë¶€ë”” ì§€êµ¬ë¥¼ ìœ„ê¸°ë¡œë¶€í„° êµ¬í•´ì£¼ì„¸ìš”! 

ì´ë²ˆ í”„ë¡œì íŠ¸ëŠ” `ë¶€ìŠ¤íŠ¸ìº í”„ AI Tech 7ê¸°` CV íŠ¸ë™ ë‚´ì—ì„œ ì§„í–‰ëœ ëŒ€íšŒì´ë©° `mAP50(Mean Average Precision)`ë¥¼ í†µí•´ ìµœì¢…í‰ê°€ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

<br />

## ğŸ“… í”„ë¡œì íŠ¸ ì¼ì •
í”„ë¡œì íŠ¸ ì „ì²´ ì¼ì •

- 2024.09.30(ëª©) ~ 2024.10.24(ëª©)

<br />

## ğŸ¥ˆ í”„ë¡œì íŠ¸ ê²°ê³¼
### Public
- **18** / 24
- mAP50 : **0.6877**
### Private
- **18** / 24
- mAP50 : **0.6754**

<br />

## ğŸ¥‰ ë°ì´í„°ì…‹ êµ¬ì¡°
```
 dataset/
 â”œâ”€â”€ train.json
 â”œâ”€â”€ test.json
 â”œâ”€â”€ test
 â”‚   â””â”€ images
 â””â”€â”€ train
     â””â”€ images
 
```
ì´ ì½”ë“œëŠ” `ë¶€ìŠ¤íŠ¸ìº í”„ AI Tech`ì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„°ì…‹ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„±ì„ ë”°ë¦…ë‹ˆë‹¤. 
- ì „ì²´ ì´ë¯¸ì§€ ê°œìˆ˜ : 9754ì¥
- ì´ë¯¸ì§€ í¬ê¸° : (1024, 1024)
- ë¶„ë¥˜ í´ë˜ìŠ¤(10ê°œ) : General trash, Paper, Paper pack, Metal, Glass, Plastic, Styrofoam, Plastic bag, Battery, Clothing
- ì „ì²´ ë°ì´í„° ì¤‘ í•™ìŠµë°ì´í„° 4883ì¥, í‰ê°€ë°ì´í„° 4871ì¥ìœ¼ë¡œ ì‚¬ìš©
- í•™ìŠµ ë°ì´í„° í˜•ì‹: COCO format
- ì œì¶œ í˜•ì‹ : Pascal VOC format csv íŒŒì¼
<br />

## ğŸ¥‰ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
project/
â”‚   README.md
â”‚   requirements.txt
â”‚   start_ngrok.py
â”‚
â”œâ”€â”€â”€EDA
â”‚       CV08_EDA.pdf
â”‚
â”œâ”€â”€â”€mmdetection
â”‚   â”œâ”€â”€â”€configs
â”‚   â”‚   â”œâ”€â”€â”€a_custom
â”‚   â”‚             train_base_cascade.py
â”‚   â”‚             train_base_cascade_swin_L.py
â”‚   â”‚             train_base_ddq.py
â”‚   â”‚             train_base_deformable_detr.py
â”‚   â”‚             train_base_dino.py
â”‚   â”‚             train_base_dino_val.py
â”‚   â”‚             train_base_efficientNet.py
â”‚   â”‚             train_base_faster_rcnn.py
â”‚   â”‚             train_base_retinanet_swin_L.py
â”‚   â”œâ”€â”€â”€tools
â”‚            fold_train.py
â”‚
â”œâ”€â”€â”€refac_torchvision
â”‚   â”‚   main.py
â”‚   â”‚
â”‚   â”œâ”€â”€â”€data
â”‚   â”‚       custom_dataset.py
â”‚   â”‚       transforms.py
â”‚   â”‚
â”‚   â”œâ”€â”€â”€models
â”‚   â”‚       model.py
â”‚   â”‚       save_load.py
â”‚   â”‚
â”‚   â”œâ”€â”€â”€process
â”‚   â”‚       img_process.py
â”‚   â”‚
â”‚   â””â”€â”€â”€train
â”‚           eval.py
â”‚           loss.py
â”‚           train.py
â”‚           utils.py
â”‚
â”œâ”€â”€â”€tools
â”‚       cleansing_labels.ipynb
â”‚       coco2yolo.py
â”‚       csv_bbox_visualize.ipynb
â”‚       ensemble.ipynb
â”‚       json_bbox_visualize.ipynb
â”‚       json_coco2pascal.ipynb
â”‚
â””â”€â”€â”€yolo
    â”‚   yolo_inference.ipynb
    â”‚   yolo_train.ipynb
    â”‚
    â””â”€â”€â”€cfg
            coco-trash.yaml
```
### 1) MMDetection
- `configs/a_custom/`: MMDetection ëª¨ë¸ì˜ í•™ìŠµê³¼ ì¶”ë¡ ì— í•„ìš”í•œ ì„¤ì • íŒŒì¼ë“¤ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.
- `tools/fold_train.py`: Stratified Group K-Fold êµì°¨ ê²€ì¦ì„ í†µí•œ í•™ìŠµì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

### 2) refac_torchvision
- `data/`: ë°ì´í„°ì…‹ ë¡œë”© ë° ì „ì²˜ë¦¬ ê´€ë ¨ ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- `models/`: ëª¨ë¸ ë¡œë“œ ë° ì €ì¥ ê´€ë ¨ íŒŒì¼ì„ í¬í•¨í•©ë‹ˆë‹¤.
- `process/`: ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- `train/`: ëª¨ë¸ í•™ìŠµ ë° í‰ê°€ì— í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤.

### 3) tools
- `cleansing_labels.ipynb`: ë ˆì´ë¸” í´ë Œì§• ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë…¸íŠ¸ë¶ì…ë‹ˆë‹¤.
- `coco2yolo.py`: COCO í˜•ì‹ì˜ ë°ì´í„°ì…‹ì„ YOLO í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.
- `csv_bbox_visualize.ipynb`, `json_bbox_visualize.ipynb`: ë°”ìš´ë”© ë°•ìŠ¤ ì‹œê°í™”ë¥¼ ìœ„í•œ ë…¸íŠ¸ë¶ íŒŒì¼ì…ë‹ˆë‹¤.
- `json_coco2pascal.ipynb`: COCO í˜•ì‹ì˜ JSON íŒŒì¼ì„ Pascal VOC í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ê³  CSVë¡œ ì €ì¥í•©ë‹ˆë‹¤.
- `ensemble.ipynb`: CSV í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ëœ ì¶”ë¡  ê²°ê³¼ íŒŒì¼ë“¤ì„ ì•™ìƒë¸”(NMS, WBF) ë° NMW(Non-Maximum Weighted) ë°©ì‹ì„ ì ìš©í•˜ì—¬ ìµœì í™”í•©ë‹ˆë‹¤.

### 4) YOLO
- `yolo_inference.ipynb`: YOLO ëª¨ë¸ì„ ì´ìš©í•´ ì¶”ë¡  ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë…¸íŠ¸ë¶ íŒŒì¼ì…ë‹ˆë‹¤.
- `yolo_train.ipynb`: YOLO ëª¨ë¸ì˜ í•™ìŠµì„ ìœ„í•œ ë…¸íŠ¸ë¶ íŒŒì¼ì…ë‹ˆë‹¤.
- `cfg/`: YOLO í•™ìŠµ ì„¤ì •ì„ ìœ„í•œ êµ¬ì„± íŒŒì¼ë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤.

<br />

## âš™ï¸ ì„¤ì¹˜

### Dependencies
ì´ ëª¨ë¸ì€ Tesla v100 32GBì˜ í™˜ê²½ì—ì„œ ì‘ì„± ë° í…ŒìŠ¤íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤.
ë˜ ëª¨ë¸ ì‹¤í–‰ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

```bash
pip install -r requirements.txt
mim install mmcv-full==1.7.0
mim install mmcv==2.1.0
mim install mmengine
```

- visdom==0.2.4
- seaborn==0.12.2
- albumentations==0.4.6
- imgaug==0.4.0
- pycocotools==2.0.6
- opencv-python==4.7.0.72
- tqdm==4.65.0
- torchnet==0.0.4
- pandas
- map-boxes==1.0.5
- jupyter==1.0.0
- openmim
- mmdet==3.3.0

<br />

## ğŸš€ ë¹ ë¥¸ ì‹œì‘
### Train
#### MMDetection

```python
# fold train
python tools/fold_train.py {config_path}

# train
python tools/train.py {config_path}
```

#### Torchvision
```python
python main.py
```
##### Torchvision Parser
ê¸°ë³¸ ì„¤ì •
- `--annotations_path` : train.json path
- `--data_dir` : Dataset directory
- `--model_name` : í•™ìŠµ ì§„í–‰í•  ëª¨ë¸ ì´ë¦„ ( ê¸°ë³¸ê°’: Faster RCNN )
- `--device` : `cuda` or `cup` ( ê¸°ë³¸ê°’ : cuda )
- `--base_dir` : result path

í•™ìŠµ ì„¤ì •
- `--num_epochs` : í•™ìŠµí•  ì—í­ ìˆ˜ (ê¸°ë³¸ê°’ : 1)
- `--batch_size` : ë°°ì¹˜ í¬ê¸° ê²°ì • ( ê¸°ë³¸ê°’ : 32 )
- `--n_split` : fold split ìˆ˜ëŸ‰ ( ê¸°ë³¸ê°’ : 5 )
- `--training_mode` : `standard` or `fold` (í•„ìˆ˜)

ì˜µí‹°ë§ˆì´ì € ì„¤ì •
- `--optimizer` : `SGD` or `AdamW` ( ê¸°ë³¸ê°’ : SGD )
- `--learning_rate` : í•™ìŠµë¥  ì„¤ì • ( ê¸°ë³¸ê°’ : 0.001)
- `--momentum` : SGD Momentum ê°’ ì„¤ì • ( ê¸°ë³¸ê°’ 0.9 )
- `--weight_decay` : ì˜µí‹°ë§ˆì´ì € weight decay ì„¤ì • ( ê¸°ë³¸ê°’ : 0.0009 )

ìŠ¤ì¼€ì¥´ëŸ¬ ì„¤ì • (CosineAnnealing)
- `--scheduler_t_max` : ì½”ì‚¬ì¸ ì–´ë„ë§ t max ì„¤ì • ( ê¸°ë³¸ê°’ : 40)
- `--scheduler_eta_min` : ì½”ì‚¬ì¸ ì–´ë„ë§ eta min ì„¤ì • ( ê¸°ë³¸ê°’ : 0)

### Test
#### MMDetection
```python
python tools/test.py {config_path} {pth_file_path}
```

##### MMDetection Parser
- `--tta` : Test Time Augmentation í™œì„±í™”
<br />

## ğŸ… Wrap-Up Report   
### [ Wrap-Up Report ğŸ‘‘]
